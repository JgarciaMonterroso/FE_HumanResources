@using FE_HumanResources.Models
@inject ILocalStorageService LocalStorage
@inject NavigationManager NavigationManager
@inject IToastService toastService
@inject HttpClient Http

<div id="layoutSidenav_nav">
    <nav class="sidenav shadow-right sidenav-light">
        <div class="sidenav-menu">
            <div class="nav accordion" id="accordionSidenav">
                <!-- Sidenav Menu Heading (Core)-->
                <div class="sidenav-menu-heading">Sistema</div>
                <!-- Sidenav Accordion (Dashboard)-->
                <a class="nav-link collapsed" href="javascript:void(0);" data-bs-toggle="collapse"
                    data-bs-target="#collapseDashboards" aria-expanded="false" aria-controls="collapseDashboards">
                    <div class="nav-link-icon"><i class="bi bi-activity"></i></div>
                    Usuario
                    <div class="sidenav-collapse-arrow"><i class="bi bi-chevron-down"></i></div>
                </a>
                <div class="collapse" id="collapseDashboards" data-bs-parent="#accordionSidenav">
                    <nav class="sidenav-menu-nested nav accordion" id="accordionSidenavPages">
                        <a class="nav-link" href="perfil">
                            Perfil
                            <span class="badge bg-primary-soft text-primary ms-auto">Editar</span>
                        </a>
                        <a class="nav-link" href="usersgrid">
                            Listado de usuarios
                            @* <span class="badge bg-primary-soft text-primary ms-auto">Editar</span> *@
                        </a>

                    </nav>
                </div>

            </div>
        </div>
        <!-- Sidenav Footer-->
        <div class="sidenav-footer">
            <div class="sidenav-footer-content">
                <div class="sidenav-footer-subtitle">Sesión iniciada como:</div>
                <div class="sidenav-footer-title">@username</div>
            </div>
        </div>
    </nav>
</div>

@* <div class="top-row ps-3 navbar navbar-dark">
<div class="container-fluid">
<a class="navbar-brand" href="">Human Resources</a>
<button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
<span class="navbar-toggler-icon"></span>
</button>
</div>
</div>

<div class="@NavMenuCssClass nav-scrollable" @onclick="ToggleNavMenu">
<nav class="flex-column">
<div class="nav-item px-3">
<NavLink class="nav-link" href="dashboard">
<span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Dashboard
</NavLink>
</div>
<div class="nav-item px-3">
<NavLink class="nav-link" href="perfil">
<span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Mi Perfil
</NavLink>
</div>
<div class="nav-item px-3">
<NavLink class="nav-link" href="usersgrid">
<span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Usuarios
</NavLink>
</div>
<div class="nav-item px-3">
<button id="kt_sign_in_submit" class="btn btn-primary" @onclick="logout">cerrar sesión</button>
</div>
</nav>
</div> *@

@code {
    private UserModel userModel = null;
    private bool collapseNavMenu = true;
    string username = "";

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    protected override async Task OnInitializedAsync()
    {

        userModel = null;
        string? usr = await LocalStorage.GetItemAsync<string>("logedUser");

        if (!string.IsNullOrEmpty(usr))
        {
            userModel = JsonConvert.DeserializeObject<UserModel>(usr);
            username = userModel.UserName + " " + userModel.LastName;
        }
        else
        {
            NavigationManager.NavigateTo("login", true);
        }
    }

}
